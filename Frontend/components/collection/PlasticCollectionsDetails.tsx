import React, { FC, useState } from "react";
import { Text, TouchableOpacity } from "react-native";
import { Badge, Card, List, useTheme } from "react-native-paper";

type PlasticCollectionDetailProps = {
  plasticCollection: PlasticCollection;
  hideWeight?: boolean;
};

// TODO: This should come autogenerated from the backend!
export type PlasticCollection = {
  id: string;
  clusterId: string;
  requesterId: string;
  recipientPartnerId: string;
  numberOfUnits: number;
  streetName: string;
  streetNumber: string;
  city: string;
  zipCode: string;
  isFirstCollection: boolean;
  isLastCollection: boolean;
  companyName?: string;
  comment?: string;
  scheduledPickupDate?: string;
  weight?: number;
  collectionStatus: "pending" | "scheduled" | "delivered" | "received";
};

// TODO: Unify this with BatchDetail!!
const PlasticCollectionDetail: FC<PlasticCollectionDetailProps> = ({
  plasticCollection,
  hideWeight = false,
  children,
}) => {
  const {
    companyName,
    streetName,
    streetNumber,
    zipCode,
    city,
    numberOfUnits,
    comment,
    weight,
  } = plasticCollection;
  const [showDetails, setShowDetails] = useState(false);
  const toggleDetails = () => setShowDetails(!showDetails);

  const { colors } = useTheme();

  const title = companyName || `${streetName} ${streetNumber}`;

  return (
    <Card style={styles.card}>
      <TouchableOpacity onPress={toggleDetails}>
        <Card.Title title={title} />
      </TouchableOpacity>
      {showDetails && (
        <Card.Content style={styles.cardContent}>
          {companyName && <Text style={styles.cardText}>{companyName}</Text>}
          <Text style={styles.cardText}>
            {streetName} {streetNumber}
          </Text>
          <Text style={styles.cardText}>
            {city} {zipCode}
          </Text>
          {comment && <Text style={styles.cardText}>{comment}</Text>}
          {weight && !hideWeight && (
            <Text style={styles.cardText}>VÃ¦gt: {weight}kg</Text>
          )}
          <Text>
            Antal enheder{" "}
            <Badge
              visible
              style={{ backgroundColor: colors.primary }}
              size={30}
            >
              {numberOfUnits}
            </Badge>
          </Text>
          {children}
        </Card.Content>
      )}
      {/* TODO: Make a button to register schedule pick-up and another to register delivery */}
    </Card>
  );
};

type Props = {
  plasticCollections: PlasticCollection[];
  title: string;
  hideWeight?: boolean;
  children?: (plasticCollection: PlasticCollection) => React.ReactNode;
};

const PlasticCollectionsDetails: FC<Props> = ({
  plasticCollections,
  title,
  hideWeight = false,
  children,
}) => {
  return (
    <List.Section>
      <List.Subheader style={styles.listHeader}>{title}</List.Subheader>
      {plasticCollections.map((collection) => (
        <PlasticCollectionDetail
          key={collection.id}
          plasticCollection={collection}
          hideWeight={hideWeight}
        >
          {children && children(collection)}
        </PlasticCollectionDetail>
      ))}
    </List.Section>
  );
};

const styles = {
  card: {
    marginBottom: 15,
  },
  cardContent: {
    borderWidth: 0.3,
    padding: 15,
    margin: 15,
    borderColor: "lightgrey",
    borderStyle: "solid" as "solid",
  },
  cardText: {
    marginBottom: 5,
    paddingBottom: 5,
    textWeight: 600 as 600,
    borderBottomColor: "lightgrey",
    borderBottomWidth: 1,
    borderBottomStyle: "solid" as "solid",
    width: "fit-content",
  },
  listHeader: {
    fontSize: 25,
    fontWeight: "900" as "900",
  },
};

export default PlasticCollectionsDetails;
