import { DateTime } from "luxon";
import React, { FC, useState } from "react";
import { Text } from "react-native";
import { Card, List } from "react-native-paper";

// TODO: This should come autogenerated from the backend
// once we have end-to-end typings!!
export type Batch = {
  id: string;
  clusterId: string;
  inputWeight: number;
  outputWeight: number;
  creatorName: string;
  recipientName: string;
  creationDate: string;
  batchStatus: "created" | "sent" | "received";
};

type BatchDetailProps = { batch: Batch };

const BatchDetail: FC<BatchDetailProps> = ({ batch, children }) => {
  const [showDetails, setShowDetails] = useState(false);
  const toggleDetails = () => setShowDetails(!showDetails);

  const creationDateTime = DateTime.fromISO(batch.creationDate);
  const title = `Oprettet af ${
    batch.creatorName
  } d ${creationDateTime.toLocaleString({ month: "long", day: "2-digit" })}`;
  return (
    <Card onPress={toggleDetails} style={styles.card}>
      <Card.Title title={title} />
      {showDetails && (
        <Card.Content style={styles.cardContent}>
          <Text style={styles.cardText}>
            Plast input: {batch.inputWeight}kg
          </Text>
          <Text style={styles.cardText}>
            Batch v√¶gt: {batch.outputWeight}kg
          </Text>
          <Text style={styles.cardText}>
            Batch oprettet af: {batch.creatorName}
          </Text>
          {batch.recipientName && (
            <Text style={styles.cardText}>
              Batch sendt til: {batch.recipientName}
            </Text>
          )}
          {children}
        </Card.Content>
      )}
    </Card>
  );
};

type Props = {
  batches: Batch[];
  title: string;
  children?: (batch: Batch) => React.ReactNode;
};

const BatchDetails: FC<Props> = ({ batches, title, children }) => {
  return (
    <List.Section>
      <List.Subheader style={styles.listHeader}>{title}</List.Subheader>
      {batches.map((batch) => (
        <BatchDetail batch={batch} key={batch.id}>
          {children && children(batch)}
        </BatchDetail>
      ))}
    </List.Section>
  );
};

const styles = {
  card: {
    marginBottom: 15,
  },
  cardContent: {
    borderWidth: 0.3,
    padding: 15,
    margin: 15,
    borderColor: "lightgrey",
    borderStyle: "solid" as "solid",
  },
  cardText: {
    marginBottom: 5,
    paddingBottom: 5,
    textWeight: 600 as 600,
    borderBottomColor: "lightgrey",
    borderBottomWidth: 1,
    borderBottomStyle: "solid" as "solid",
    width: "fit-content",
  },
  listHeader: {
    fontSize: 28,
    fontWeight: "900" as "900",
  },
};

export default BatchDetails;
